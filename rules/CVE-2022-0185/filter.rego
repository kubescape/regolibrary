package armo_builtins

import rego.v1

deny contains msga if {
	node := input[_]
	node.kind == "Node"

	node.status.nodeInfo.operatingSystem == "linux"

	linux_kernel_vars := [linux_kernel_var | linux_kernel_var = input[_]; linux_kernel_var.kind == "LinuxKernelVariables"]
	linux_kernel_vars_for_node := [linux_kernel_var | linux_kernel_var = linux_kernel_vars[_]; linux_kernel_var.metadata.name == node.metadata.name]

	external_vector := {
		"name": node.metadata.name,
		"namespace": "",
		"kind": node.kind,
		"relatedObjects": linux_kernel_vars_for_node,
		"kernelVersion": node.status.nodeInfo.kernelVersion,
	}

	msga := {
		"alertMessage": "You are vulnerable to CVE-2022-0185",
		"alertObject": {"externalObjects": external_vector},
		"failedPaths": [],
		"fixPaths": [],
	}
}
