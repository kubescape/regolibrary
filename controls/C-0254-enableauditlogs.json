{
  "controlID": "C-0254",
  "name": "Enable audit Logs",
  "description": "With Azure Kubernetes Service (AKS), the control plane components such as the kube-apiserver and kube-controller-manager are provided as a managed service. You create and manage the nodes that run the kubelet and container runtime, and deploy your applications through the managed Kubernetes API server. To help troubleshoot your application and services, you may need to view the logs generated by these control plane components. To help collect and review data from multiple sources, Azure Monitor logs provides a query language and analytics engine that provides insights to your environment. A workspace is used to collate and analyze the data, and can integrate with other Azure services such as Application Insights and Security Center.",
  "long_description": "Exporting logs and metrics to a dedicated, persistent datastore ensures availability of audit data following a cluster security event, and provides a central location for analysis of log and metric data collated from multiple sources.",
  "remediation": "Azure audit logs are enabled and managed in the Azure portal. To enable log collection for the Kubernetes master components in your AKS cluster, open the Azure portal in a web browser and complete the following steps: 1. Select the resource group for your AKS cluster, such as myResourceGroup. Don't select the resource group that contains your individual AKS cluster resources, such as MC\\_myResourceGroup\\_myAKSCluster\\_eastus.2. On the left-hand side, choose Diagnostic settings.3. Select your AKS cluster, such as myAKSCluster, then choose to Add diagnostic setting.4. Enter a name, such as myAKSClusterLogs, then select the option to Send to Log Analytics.5. Select an existing workspace or create a new one. If you create a workspace, provide a workspace name, a resource group, and a location.6. In the list of available logs, select the logs you wish to enable. For this example, enable the kube-audit and kube-audit-admin logs. Common logs include the kube-apiserver, kube-controller-manager, and kube-scheduler. You can return and change the collected logs once Log Analytics workspaces are enabled.7. When ready, select Save to enable collection of the selected logs.",
  "manual_test": "",
  "references": [
    "<https://kubernetes.io/docs/tasks/debug-application-cluster/audit/>  <https://docs.microsoft.com/en-us/azure/aks/view-master-logs>  <https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-logging-threat-detection#lt-4-enable-logging-for-azure-resources>"
  ],
  "attributes": {
    "armoBuiltin": true
  },
  "rulesNames": [
    "rule-manual"
  ],
  "baseScore": 5,
  "impact_statement": "What is collected from Kubernetes clustersContainer insights includes a predefined set of metrics and inventory items collected that are written as log data in your Log Analytics workspace. All metrics listed below are collected by default every one minute. Node metrics collectedThe following list is the 24 metrics per node that are collected: cpuUsageNanoCorescpuCapacityNanoCorescpuAllocatableNanoCoresmemoryRssBytesmemoryWorkingSetBytesmemoryCapacityBytesmemoryAllocatableBytesrestartTimeEpochused (disk)free (disk)used\\_percent (disk)io\\_time (diskio)writes (diskio)reads (diskio)write\\_bytes (diskio)write\\_time (diskio)iops\\_in\\_progress (diskio)read\\_bytes (diskio)read\\_time (diskio)err\\_in (net)err\\_out (net)bytes\\_recv (net)bytes\\_sent (net)Kubelet\\_docker\\_operations (kubelet)Container metricsThe following list is the eight metrics per container collected: cpuUsageNanoCorescpuRequestNanoCorescpuLimitNanoCoresmemoryRssBytesmemoryWorkingSetBytesmemoryRequestBytesmemoryLimitBytesrestartTimeEpochCluster inventoryThe following list is the cluster inventory data collected by default: KubePodInventory – 1 per minute per containerKubeNodeInventory – 1 per node per minuteKubeServices – 1 per service per minuteContainerInventory – 1 per container per minute",
  "default_value": "By default, cluster control plane logs aren't sent to be Logged.",
  "scanningScope": {
    "matches": [
      [
        "cluster",
        "cloud",
        "AKS"
      ]
    ]
  }
}
